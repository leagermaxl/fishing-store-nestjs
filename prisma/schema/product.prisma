model Product {
  id String @id @default(uuid())

  name        String
  description String?
  categoryId  String?            @map("category_id")
  category    Category?          @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  images      String[]
  variants    ProductVariant[]
  attributes  ProductAttribute[]
  discountId  String?            @map("discount_id")
  discount    Discount?          @relation(fields: [discountId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("products")
}

model ProductAttribute {
  id String @id @default(uuid())

  productId String       @map("product_id")
  product   Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  typeId    String?      @map("type_id")
  type      VariantType? @relation(fields: [typeId], references: [id], onDelete: SetNull)
  value     String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_attributes")
}

model ProductVariant {
  id String @id @default(uuid())

  productId  String                    @map("product_id")
  product    Product                   @relation(fields: [productId], references: [id], onDelete: Cascade)
  sku        String                    @unique
  price      Decimal
  inStock    Int                       @default(10) @map("in_stock")
  attributes ProductVariantAttribute[]
  discountId String?                   @map("discount_id")
  discount   Discount?                 @relation(fields: [discountId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_variants")
}

model ProductVariantAttribute {
  id String @id @default(uuid())

  variantId String         @map("variant_id")
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  typeId    String?        @map("type_id")
  type      VariantType?   @relation(fields: [typeId], references: [id], onDelete: SetNull)
  value     String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_variant_attributes")
}

model VariantType {
  id String @id @default(uuid())

  categoryId               String?                   @map("category_id")
  category                 Category?                 @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  name                     String
  productAttributes        ProductAttribute[]
  productVariantAttributes ProductVariantAttribute[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("variant_types")
}
